{"version":3,"file":"loading-spec.js","sourceRoot":"","sources":["../../../src/test/features/loading-spec.ts"],"names":[],"mappings":"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","sourcesContent":["/* @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {$defaultPosterElement, $posterContainerElement} from '../../features/loading.js';\nimport {$scene, $userInputElement} from '../../model-viewer-base.js';\nimport {ModelViewerElement} from '../../model-viewer.js';\nimport {CachingGLTFLoader} from '../../three-components/CachingGLTFLoader.js';\nimport {timePasses, waitForEvent} from '../../utilities.js';\nimport {assetPath, pickShadowDescendant, rafPasses, until} from '../helpers.js';\n\nconst expect = chai.expect;\nconst CUBE_GLB_PATH = assetPath('models/cube.gltf');\nconst HORSE_GLB_PATH = assetPath('models/Horse.glb');\n\nsuite('Loading', () => {\n  let element: ModelViewerElement;\n\n  setup(async () => {\n    element = new ModelViewerElement();\n    document.body.insertBefore(element, document.body.firstChild);\n    element.poster = assetPath('../screenshot.png');\n\n    // Wait at least a microtask for size calculations\n    await timePasses();\n  });\n\n  teardown(() => {\n    CachingGLTFLoader.clearCache();\n\n    if (element.parentNode != null) {\n      element.parentNode.removeChild(element);\n    }\n  });\n\n  test('creates a poster element that captures interactions', async () => {\n    const picked = pickShadowDescendant(element);\n    expect(picked).to.be.ok;\n    // TODO(cdata): Leaky internal details here:\n    expect(picked!.id).to.be.equal('default-poster');\n  });\n\n  test('does not load when hidden from render tree', async () => {\n    let loadDispatched = false;\n    let preloadDispatched = false;\n    const loadHandler = () => {\n      loadDispatched = true;\n    };\n    const preloadHandler = () => {\n      preloadDispatched = true;\n    };\n\n    element.addEventListener('load', loadHandler);\n    element.addEventListener('preload', preloadHandler);\n\n    element.style.display = 'none';\n\n    // Give IntersectionObserver a chance to notify. In Chrome, this takes\n    // two rAFs (empirically observed). Await extra time just in case:\n    await timePasses(100);\n\n    element.src = CUBE_GLB_PATH;\n\n    await timePasses(500);  // Arbitrary time to allow model to load\n\n    element.removeEventListener('load', loadHandler);\n    element.removeEventListener('preload', preloadHandler);\n\n    expect(loadDispatched).to.be.false;\n    expect(preloadDispatched).to.be.false;\n  });\n\n  suite('load', () => {\n    suite('when a model src changes after loading', () => {\n      setup(async () => {\n        element.src = CUBE_GLB_PATH;\n        await waitForEvent(element, 'poster-dismissed');\n      });\n\n      test('only dispatches load once per src change', async () => {\n        let loadCount = 0;\n        const onLoad = () => {\n          loadCount++;\n        };\n\n        element.addEventListener('load', onLoad);\n\n        try {\n          element.src = HORSE_GLB_PATH;\n\n          await waitForEvent(element, 'load');\n\n          element.src = CUBE_GLB_PATH;\n\n          await waitForEvent(element, 'load');\n\n          // Give any late-dispatching events a chance to dispatch\n          await timePasses(300);\n\n          expect(loadCount).to.be.equal(2);\n        } finally {\n          element.removeEventListener('load', onLoad);\n        }\n      });\n\n      test('getDimensions() returns correct size', () => {\n        const size = element.getDimensions();\n        expect(size.x).to.be.eq(1);\n        expect(size.y).to.be.eq(1);\n        expect(size.z).to.be.eq(1);\n      });\n\n      test('generates 3DModel schema', async () => {\n        element.generateSchema = true;\n        await element.updateComplete;\n        const {schemaElement} = element[$scene];\n        expect(schemaElement.type).to.be.eq('application/ld+json');\n        expect(schemaElement.parentElement).to.be.eq(document.head);\n        const json = JSON.parse(schemaElement.textContent!);\n        const encoding = json.encoding[0];\n\n        expect(encoding.contentUrl).to.be.eq(CUBE_GLB_PATH);\n        expect(encoding.encodingFormat).to.be.eq('model/gltf+json');\n\n        element.generateSchema = false;\n        await element.updateComplete;\n        expect(schemaElement.parentElement).to.be.not.ok;\n      });\n    });\n  });\n\n  suite('loading', () => {\n    suite('src changes quickly', () => {\n      test('eventually notifies that current src is preloaded', async () => {\n        element.loading = 'eager';\n        element.src = CUBE_GLB_PATH;\n\n        await timePasses();\n\n        let preloadEvent = null;\n        const onPreload = (event: CustomEvent) => {\n          if (event.detail.url === HORSE_GLB_PATH) {\n            preloadEvent = event;\n          }\n        };\n        element.addEventListener<any>('preload', onPreload);\n\n        element.src = HORSE_GLB_PATH;\n\n        await until(() => element.loaded);\n\n        await timePasses();\n\n        element.removeEventListener<any>('preload', onPreload);\n\n        expect(preloadEvent).to.be.ok;\n      });\n    });\n\n\n    suite('reveal', () => {\n      suite('auto', () => {\n        test('hides poster when element loads', async () => {\n          element.src = CUBE_GLB_PATH;\n          const input = element[$userInputElement];\n\n          expect(pickShadowDescendant(element))\n              .to.be.not.equal(\n                  input, 'the poster should be shown until the model loads');\n\n          await waitForEvent(\n              element,\n              'model-visibility',\n              (event: any) => event.detail.visible);\n\n          await rafPasses();\n\n          expect(pickShadowDescendant(element)).to.be.equal(input);\n\n          element.reveal = 'manual';\n          await element.updateComplete;\n          await rafPasses();\n\n          expect(pickShadowDescendant(element))\n              .to.be.equal(input, 'changing reveal should not show the poster');\n        });\n      });\n\n      suite('manual', () => {\n        test('does not hide poster until dismissed', async () => {\n          element.loading = 'eager';\n          element.reveal = 'manual';\n          element.src = CUBE_GLB_PATH;\n\n          const posterElement = (element as any)[$defaultPosterElement];\n          const input = element[$userInputElement];\n\n          await waitForEvent(element, 'load');\n\n          posterElement.focus();\n\n          expect(element.shadowRoot!.activeElement).to.be.equal(posterElement);\n\n          element.dismissPoster();\n\n          await until(() => {\n            return element.shadowRoot!.activeElement === input;\n          });\n        });\n      });\n    });\n  });\n\n  suite('configuring poster via attribute', () => {\n    suite('removing the attribute', () => {\n      test('sets poster to null', async () => {\n        // NOTE(cdata): This is less important after we resolve\n        // https://github.com/PolymerLabs/model-viewer/issues/76\n        element.setAttribute('poster', CUBE_GLB_PATH);\n        await timePasses();\n        element.removeAttribute('poster');\n        await timePasses();\n        expect(element.poster).to.be.equal(null);\n      });\n    });\n  });\n\n  suite('with loaded model src', () => {\n    setup(() => {\n      element.src = CUBE_GLB_PATH;\n    });\n\n    test('can be hidden imperatively', async () => {\n      const ostensiblyThePoster = pickShadowDescendant(element);\n\n      element.dismissPoster();\n\n      await waitForEvent<CustomEvent>(\n          element, 'model-visibility', event => event.detail.visible === true);\n\n      await rafPasses();\n\n      const ostensiblyNotThePoster = pickShadowDescendant(element);\n\n      expect(ostensiblyThePoster).to.not.be.equal(ostensiblyNotThePoster);\n    });\n\n    suite('when poster is hidden', () => {\n      setup(async () => {\n        element.dismissPoster();\n        await waitForEvent<CustomEvent>(\n            element,\n            'model-visibility',\n            event => event.detail.visible === true);\n        await rafPasses();\n      });\n\n      test('allows the input to be interactive', async () => {\n        const input = element[$userInputElement];\n        const picked = pickShadowDescendant(element);\n\n        expect(picked).to.be.equal(input);\n      });\n\n      test('when src is reset, poster is dismissible', async () => {\n        const posterElement = (element as any)[$defaultPosterElement];\n        const posterContainer = (element as any)[$posterContainerElement];\n        const inputElement = element[$userInputElement];\n\n        element.reveal = 'manual';\n        element.src = null;\n        element.showPoster();\n\n        await timePasses();\n\n        element.src = CUBE_GLB_PATH;\n\n        await timePasses();\n\n        expect(posterContainer.classList.contains('show')).to.be.true;\n\n        posterElement.focus();\n\n        expect(element.shadowRoot!.activeElement).to.be.equal(posterElement);\n\n        element.dismissPoster();\n\n        await until(() => {\n          return element.shadowRoot!.activeElement === inputElement;\n        });\n      });\n    });\n  });\n});\n"]}